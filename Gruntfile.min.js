var grunt=require("grunt"),toml=require("toml"),S=require("string");grunt.loadNpmTasks("grunt-open");grunt.loadNpmTasks("grunt-shell");module.exports=function(a){a.registerTask("lunr-index-cs",function(){var e="content/cs";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.cs.json",JSON.stringify(c()));a.log.ok("Index built.")});a.registerTask("lunr-index-de",function(){var e="content/de";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.de.json",JSON.stringify(c()));a.log.ok("Index built.")});a.registerTask("lunr-index-en",function(){var e="content/en";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.en.json",JSON.stringify(c()));a.log.ok("Index built.")});a.registerTask("lunr-index-es",function(){var e="content/es";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.es.json",JSON.stringify(c()));a.log.ok("Index built.")});a.registerTask("lunr-index-fr",function(){var e="content/fr";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.fr.json",JSON.stringify(c()));a.log.ok("Index built.")});a.registerTask("lunr-index-it",function(){var e="content/it";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.it.json",JSON.stringify(c()));a.log.ok("Index built.")});a.registerTask("lunr-index-ru",function(){var e="content/ru";a.log.writeln("Building pages index...");var c=function(){var g=[];a.file.recurse(e,function(k,j,h,i){a.verbose.writeln("Parse file:",k);g.push(d(k,i))});return g};var d=function(i,h){var g;if(S(h).endsWith(".html")){g=b(i,h)}else{g=f(i,h)}return g};var b=function(k,h){var j=a.file.read(k);var g=S(h).chompRight(".html").s;var i=S(k).chompLeft(e).s;return{title:g,url:i,content:S(j).trim().stripTags().stripPunctuation().s}};var f=function(l,h){var j=a.file.read(l);var g;j=j.split("+++");var k;try{k=toml.parse(j[1].trim())}catch(m){conzole.failed(m.message)}if(k.url){var i=k.url}else{var i=S(l).chompLeft(e).chompRight(".md").s;if(h==="index.md"){i=S(l).chompLeft(e).chompRight(h).s}}g={title:k.title,tags:k.tags,url:i,content:S(j[2]).trim().stripTags().stripPunctuation().s};return g};a.file.write("static/json/search.ru.json",JSON.stringify(c()));a.log.ok("Index built.")});a.initConfig({shell:{options:{stdout:true},server:{command:"hugo server --theme=enectiva-faq"},build:{command:"hugo -d public/ --theme=enectiva-faq"}},open:{devserver:{path:"http://localhost:1313",app:"firefox",},live:{path:"http://faq.enectiva.cz",app:"firefox",}}});a.registerTask("test",["lunr-index-cs","lunr-index-de","lunr-index-en","lunr-index-es","lunr-index-fr","lunr-index-it","lunr-index-ru","open:devserver","shell:server"]);a.registerTask("build",["lunr-index-cs","lunr-index-de","lunr-index-en","lunr-index-es","lunr-index-fr","lunr-index-it","lunr-index-ru","open:live","shell:build"]);a.registerTask("all-indexes",["lunr-index-cs","lunr-index-de","lunr-index-en","lunr-index-es","lunr-index-fr","lunr-index-it","lunr-index-ru"])};